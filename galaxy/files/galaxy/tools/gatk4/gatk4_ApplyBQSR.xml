<tool id="gatk4_ApplyBQSR" name="GATK4 ApplyBQSR" version="1.0.0">
    <description>- Apply base quality score recalibration</description>
    <requirements>
      <requirement type="package" version="4.2.6.1">gatk4</requirement>
    </requirements>

    <command>
        <![CDATA[
        #set $fasta_file = $fasta_source.fasta_id.fields.path
        ln -s '${fasta_file}.fai' 'input.fasta.fai' &&
        ln -s '$fasta_file' 'input.fasta' &&
          gatk --java-options "-Xms4G -Xmx4G -XX:ParallelGCThreads=2" ApplyBQSR \
            -I "$INPUT" \
            -O "$OUTPUT" \
            -R 'input.fasta' \
            --bqsr-recal-file "$RECAL_TABLE"
        ]]>
    </command>
    <inputs>
      <param name="INPUT" type="data" format="bam" label="BAM file" />
      <param name="RECAL_TABLE" type="data" format="tabular" label="Covariates table" help="Recalibration file generated by BaseRecalibrator on the input BAM or CRAM file." />
      <param name="GENOME" type="select" label="Select reference genome" help="If your genome of interest is not listed, contact the Galaxy team">
        <options from_data_table="fasta_indexes" />
      </param>
    </inputs>
    <outputs>
        <data name="OUTPUT" type="data" format="bam" label="Recalibrated BAM file"/>
    </outputs>

    <tests>
    </tests>

    <help>
      **What it does**

      Apply base quality score recalibration
      This tool performs the second pass in a two-stage process called Base Quality Score Recalibration (BQSR). Specifically, it recalibrates the base qualities of the input reads based on the recalibration table produced by the BaseRecalibrator tool, and outputs a recalibrated BAM or CRAM file.

      https://gatk.broadinstitute.org/hc/en-us/articles/360037055712-ApplyBQSR

    </help>

</tool>
